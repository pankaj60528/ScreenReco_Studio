{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rohit/OneDrive/Desktop/shareable-screen-studio/src/lib/db.ts"],"sourcesContent":["import fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { nanoid } from 'nanoid';\r\n\r\nexport interface VideoRecord {\r\n  id: string;\r\n  title: string;\r\n  sourceUrl: string;\r\n  trimmedUrl: string;\r\n  durationSeconds: number | null;\r\n  trimStart?: number;\r\n  trimEnd?: number;\r\n  shareId: string;\r\n  viewCount: number;\r\n  completionPercent: number;\r\n  createdAt: string;\r\n}\r\n\r\ninterface StoreShape {\r\n  videos: VideoRecord[];\r\n}\r\n\r\nconst dataDir = path.join(process.cwd(), 'data');\r\nconst dataFile = path.join(dataDir, 'videos.json');\r\nconst tmpDataFile = path.join(dataDir, 'videos.json.tmp');\r\n\r\nasync function ensureStore(): Promise<StoreShape> {\r\n  await fs.mkdir(dataDir, { recursive: true });\r\n  try {\r\n    const content = await fs.readFile(dataFile, 'utf-8');\r\n    return JSON.parse(content) as StoreShape;\r\n  } catch (err: any) {\r\n    if (err?.code === 'ENOENT') {\r\n      const initial: StoreShape = { videos: [] };\r\n      await fs.writeFile(dataFile, JSON.stringify(initial, null, 2), 'utf-8');\r\n      return initial;\r\n    }\r\n\r\n    // Don't overwrite the store on transient errors (e.g., OneDrive lock / EBUSY)\r\n    throw err;\r\n  }\r\n}\r\n\r\nasync function saveStore(store: StoreShape) {\r\n  const payload = JSON.stringify(store, null, 2);\r\n  await fs.writeFile(tmpDataFile, payload, 'utf-8');\r\n  await fs.rename(tmpDataFile, dataFile);\r\n}\r\n\r\nexport async function addVideo(params: {\r\n  title: string;\r\n  url: string;\r\n  durationSeconds?: number;\r\n  trimStart?: number;\r\n  trimEnd?: number;\r\n}): Promise<VideoRecord> {\r\n  const store = await ensureStore();\r\n  const id = nanoid(10);\r\n  const shareId = nanoid(8);\r\n  const record: VideoRecord = {\r\n    id,\r\n    title: params.title,\r\n    sourceUrl: params.url,\r\n    trimmedUrl: params.url,\r\n    durationSeconds: params.durationSeconds ?? null,\r\n    trimStart: params.trimStart,\r\n    trimEnd: params.trimEnd,\r\n    shareId,\r\n    viewCount: 0,\r\n    completionPercent: 0,\r\n    createdAt: new Date().toISOString(),\r\n  };\r\n  store.videos.push(record);\r\n  await saveStore(store);\r\n  return record;\r\n}\r\n\r\nexport async function getVideo(idOrShare: string): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  return store.videos.find((v) => v.id === idOrShare || v.shareId === idOrShare);\r\n}\r\n\r\nexport async function incrementView(id: string): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  const video = store.videos.find((v) => v.id === id || v.shareId === id);\r\n  if (video) {\r\n    video.viewCount += 1;\r\n    await saveStore(store);\r\n  }\r\n  return video;\r\n}\r\n\r\nexport async function updateCompletion(id: string, completionPercent: number): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  const video = store.videos.find((v) => v.id === id || v.shareId === id);\r\n  if (video) {\r\n    video.completionPercent = Math.max(video.completionPercent, completionPercent);\r\n    await saveStore(store);\r\n  }\r\n  return video;\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;;;;AAoBA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACzC,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS;AACpC,MAAM,cAAc,4GAAI,CAAC,IAAI,CAAC,SAAS;AAEvC,eAAe;IACb,MAAM,gIAAE,CAAC,KAAK,CAAC,SAAS;QAAE,WAAW;IAAK;IAC1C,IAAI;QACF,MAAM,UAAU,MAAM,gIAAE,CAAC,QAAQ,CAAC,UAAU;QAC5C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAO,KAAU;QACjB,IAAI,KAAK,SAAS,UAAU;YAC1B,MAAM,UAAsB;gBAAE,QAAQ,EAAE;YAAC;YACzC,MAAM,gIAAE,CAAC,SAAS,CAAC,UAAU,KAAK,SAAS,CAAC,SAAS,MAAM,IAAI;YAC/D,OAAO;QACT;QAEA,8EAA8E;QAC9E,MAAM;IACR;AACF;AAEA,eAAe,UAAU,KAAiB;IACxC,MAAM,UAAU,KAAK,SAAS,CAAC,OAAO,MAAM;IAC5C,MAAM,gIAAE,CAAC,SAAS,CAAC,aAAa,SAAS;IACzC,MAAM,gIAAE,CAAC,MAAM,CAAC,aAAa;AAC/B;AAEO,eAAe,SAAS,MAM9B;IACC,MAAM,QAAQ,MAAM;IACpB,MAAM,KAAK,IAAA,2JAAM,EAAC;IAClB,MAAM,UAAU,IAAA,2JAAM,EAAC;IACvB,MAAM,SAAsB;QAC1B;QACA,OAAO,OAAO,KAAK;QACnB,WAAW,OAAO,GAAG;QACrB,YAAY,OAAO,GAAG;QACtB,iBAAiB,OAAO,eAAe,IAAI;QAC3C,WAAW,OAAO,SAAS;QAC3B,SAAS,OAAO,OAAO;QACvB;QACA,WAAW;QACX,mBAAmB;QACnB,WAAW,IAAI,OAAO,WAAW;IACnC;IACA,MAAM,MAAM,CAAC,IAAI,CAAC;IAClB,MAAM,UAAU;IAChB,OAAO;AACT;AAEO,eAAe,SAAS,SAAiB;IAC9C,MAAM,QAAQ,MAAM;IACpB,OAAO,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,aAAa,EAAE,OAAO,KAAK;AACtE;AAEO,eAAe,cAAc,EAAU;IAC5C,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,EAAE,OAAO,KAAK;IACpE,IAAI,OAAO;QACT,MAAM,SAAS,IAAI;QACnB,MAAM,UAAU;IAClB;IACA,OAAO;AACT;AAEO,eAAe,iBAAiB,EAAU,EAAE,iBAAyB;IAC1E,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,EAAE,OAAO,KAAK;IACpE,IAAI,OAAO;QACT,MAAM,iBAAiB,GAAG,KAAK,GAAG,CAAC,MAAM,iBAAiB,EAAE;QAC5D,MAAM,UAAU;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rohit/OneDrive/Desktop/shareable-screen-studio/app/api/analytics/complete/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { updateCompletion } from \"@/lib/db\";\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { id, completionPercent } = await request.json();\r\n    if (!id || completionPercent === undefined) {\r\n      return NextResponse.json({ error: \"Missing id or completionPercent\" }, { status: 400 });\r\n    }\r\n\r\n    const video = await updateCompletion(id, Number(completionPercent));\r\n    if (!video) return NextResponse.json({ error: \"Video not found\" }, { status: 404 });\r\n    return NextResponse.json({ video });\r\n  } catch (error) {\r\n    console.error(\"Completion analytics error\", error);\r\n    return NextResponse.json({ error: \"Failed to record completion\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,iBAAiB,EAAE,GAAG,MAAM,QAAQ,IAAI;QACpD,IAAI,CAAC,MAAM,sBAAsB,WAAW;YAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkC,GAAG;gBAAE,QAAQ;YAAI;QACvF;QAEA,MAAM,QAAQ,MAAM,IAAA,sIAAgB,EAAC,IAAI,OAAO;QAChD,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;QACjF,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAM;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF"}}]
}