{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rohit/OneDrive/Desktop/shareable-screen-studio/src/lib/db.ts"],"sourcesContent":["import fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { nanoid } from 'nanoid';\r\n\r\nexport interface VideoRecord {\r\n  id: string;\r\n  title: string;\r\n  sourceUrl: string;\r\n  trimmedUrl: string;\r\n  durationSeconds: number | null;\r\n  trimStart?: number;\r\n  trimEnd?: number;\r\n  shareId: string;\r\n  viewCount: number;\r\n  completionPercent: number;\r\n  createdAt: string;\r\n}\r\n\r\ninterface StoreShape {\r\n  videos: VideoRecord[];\r\n}\r\n\r\nconst dataDir = path.join(process.cwd(), 'data');\r\nconst dataFile = path.join(dataDir, 'videos.json');\r\nconst tmpDataFile = path.join(dataDir, 'videos.json.tmp');\r\n\r\nasync function ensureStore(): Promise<StoreShape> {\r\n  await fs.mkdir(dataDir, { recursive: true });\r\n  try {\r\n    const content = await fs.readFile(dataFile, 'utf-8');\r\n    return JSON.parse(content) as StoreShape;\r\n  } catch (err: any) {\r\n    if (err?.code === 'ENOENT') {\r\n      const initial: StoreShape = { videos: [] };\r\n      await fs.writeFile(dataFile, JSON.stringify(initial, null, 2), 'utf-8');\r\n      return initial;\r\n    }\r\n    throw err;\r\n  }\r\n}\r\n\r\nasync function saveStore(store: StoreShape) {\r\n  const payload = JSON.stringify(store, null, 2);\r\n  await fs.writeFile(tmpDataFile, payload, 'utf-8');\r\n  await fs.rename(tmpDataFile, dataFile);\r\n}\r\n\r\nexport async function addVideo(params: {\r\n  title: string;\r\n  url: string;\r\n  durationSeconds?: number;\r\n  trimStart?: number;\r\n  trimEnd?: number;\r\n}): Promise<VideoRecord> {\r\n  const store = await ensureStore();\r\n  const id = nanoid(10);\r\n  const shareId = nanoid(8);\r\n  const record: VideoRecord = {\r\n    id,\r\n    title: params.title,\r\n    sourceUrl: params.url,\r\n    trimmedUrl: params.url,\r\n    durationSeconds: params.durationSeconds ?? null,\r\n    trimStart: params.trimStart,\r\n    trimEnd: params.trimEnd,\r\n    shareId,\r\n    viewCount: 0,\r\n    completionPercent: 0,\r\n    createdAt: new Date().toISOString(),\r\n  };\r\n  store.videos.push(record);\r\n  await saveStore(store);\r\n  return record;\r\n}\r\n\r\nexport async function getVideo(idOrShare: string): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  return store.videos.find((v) => v.id === idOrShare || v.shareId === idOrShare);\r\n}\r\n\r\n// FIX FOR ERROR 2: We name this 'getVideos'\r\nexport async function getVideos(): Promise<VideoRecord[]> {\r\n  const store = await ensureStore();\r\n  return store.videos;\r\n}\r\n\r\n// FIX FOR ERROR 1: This function was missing\r\nexport async function deleteVideo(idOrShare: string): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  const index = store.videos.findIndex((v) => v.id === idOrShare || v.shareId === idOrShare);\r\n  if (index === -1) return undefined;\r\n  const [removed] = store.videos.splice(index, 1);\r\n  await saveStore(store);\r\n  return removed;\r\n}\r\n\r\nexport async function incrementView(id: string): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  const video = store.videos.find((v) => v.id === id || v.shareId === id);\r\n  if (video) {\r\n    video.viewCount += 1;\r\n    await saveStore(store);\r\n  }\r\n  return video;\r\n}\r\n\r\nexport async function updateCompletion(id: string, completionPercent: number): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  const video = store.videos.find((v) => v.id === id || v.shareId === id);\r\n  if (video) {\r\n    video.completionPercent = Math.max(video.completionPercent, completionPercent);\r\n    await saveStore(store);\r\n  }\r\n  return video;\r\n}"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAoBA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACzC,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS;AACpC,MAAM,cAAc,4GAAI,CAAC,IAAI,CAAC,SAAS;AAEvC,eAAe;IACb,MAAM,gIAAE,CAAC,KAAK,CAAC,SAAS;QAAE,WAAW;IAAK;IAC1C,IAAI;QACF,MAAM,UAAU,MAAM,gIAAE,CAAC,QAAQ,CAAC,UAAU;QAC5C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAO,KAAU;QACjB,IAAI,KAAK,SAAS,UAAU;YAC1B,MAAM,UAAsB;gBAAE,QAAQ,EAAE;YAAC;YACzC,MAAM,gIAAE,CAAC,SAAS,CAAC,UAAU,KAAK,SAAS,CAAC,SAAS,MAAM,IAAI;YAC/D,OAAO;QACT;QACA,MAAM;IACR;AACF;AAEA,eAAe,UAAU,KAAiB;IACxC,MAAM,UAAU,KAAK,SAAS,CAAC,OAAO,MAAM;IAC5C,MAAM,gIAAE,CAAC,SAAS,CAAC,aAAa,SAAS;IACzC,MAAM,gIAAE,CAAC,MAAM,CAAC,aAAa;AAC/B;AAEO,eAAe,SAAS,MAM9B;IACC,MAAM,QAAQ,MAAM;IACpB,MAAM,KAAK,IAAA,2JAAM,EAAC;IAClB,MAAM,UAAU,IAAA,2JAAM,EAAC;IACvB,MAAM,SAAsB;QAC1B;QACA,OAAO,OAAO,KAAK;QACnB,WAAW,OAAO,GAAG;QACrB,YAAY,OAAO,GAAG;QACtB,iBAAiB,OAAO,eAAe,IAAI;QAC3C,WAAW,OAAO,SAAS;QAC3B,SAAS,OAAO,OAAO;QACvB;QACA,WAAW;QACX,mBAAmB;QACnB,WAAW,IAAI,OAAO,WAAW;IACnC;IACA,MAAM,MAAM,CAAC,IAAI,CAAC;IAClB,MAAM,UAAU;IAChB,OAAO;AACT;AAEO,eAAe,SAAS,SAAiB;IAC9C,MAAM,QAAQ,MAAM;IACpB,OAAO,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,aAAa,EAAE,OAAO,KAAK;AACtE;AAGO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,OAAO,MAAM,MAAM;AACrB;AAGO,eAAe,YAAY,SAAiB;IACjD,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM,MAAM,CAAC,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,aAAa,EAAE,OAAO,KAAK;IAChF,IAAI,UAAU,CAAC,GAAG,OAAO;IACzB,MAAM,CAAC,QAAQ,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC,OAAO;IAC7C,MAAM,UAAU;IAChB,OAAO;AACT;AAEO,eAAe,cAAc,EAAU;IAC5C,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,EAAE,OAAO,KAAK;IACpE,IAAI,OAAO;QACT,MAAM,SAAS,IAAI;QACnB,MAAM,UAAU;IAClB;IACA,OAAO;AACT;AAEO,eAAe,iBAAiB,EAAU,EAAE,iBAAyB;IAC1E,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,EAAE,OAAO,KAAK;IACpE,IAAI,OAAO;QACT,MAAM,iBAAiB,GAAG,KAAK,GAAG,CAAC,MAAM,iBAAiB,EAAE;QAC5D,MAAM,UAAU;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 169, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rohit/OneDrive/Desktop/shareable-screen-studio/app/api/videos/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n// Import 'addVideo' along with 'getVideos'\nimport { getVideos, addVideo } from \"@/lib/db\"; \n\n// 1. YOUR EXISTING GET FUNCTION (Lists videos)\nexport async function GET() {\n  try {\n    const videos = await getVideos();\n\n    // Sort by creation date (newest first)\n    const sortedVideos = videos.sort((a, b) => \n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    );\n\n    return NextResponse.json({ videos: sortedVideos });\n  } catch (error) {\n    console.error(\"Failed to fetch videos:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch videos\" }, \n      { status: 500 }\n    );\n  }\n}\n\n// 2. NEW FUNCTION TO ADD (Creates a new video)\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    \n    // Validate required fields\n    if (!body.title || !body.url) {\n      return NextResponse.json(\n        { error: \"Title and URL are required\" },\n        { status: 400 }\n      );\n    }\n\n    // Use the addVideo function from your db.ts\n    const newVideo = await addVideo({\n      title: body.title,\n      url: body.url,\n      durationSeconds: body.durationSeconds,\n      trimStart: body.trimStart,\n      trimEnd: body.trimEnd,\n    });\n\n    return NextResponse.json(newVideo, { status: 201 });\n  } catch (error) {\n    console.error(\"Failed to add video:\", error);\n    return NextResponse.json(\n      { error: \"Failed to add video\" }, \n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;AACA,2CAA2C;AAC3C;;;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,IAAA,+HAAS;QAE9B,uCAAuC;QACvC,MAAM,eAAe,OAAO,IAAI,CAAC,CAAC,GAAG,IACnC,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;QAGjE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;QAAa;IAClD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,2BAA2B;QAC3B,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,GAAG,EAAE;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,4CAA4C;QAC5C,MAAM,WAAW,MAAM,IAAA,8HAAQ,EAAC;YAC9B,OAAO,KAAK,KAAK;YACjB,KAAK,KAAK,GAAG;YACb,iBAAiB,KAAK,eAAe;YACrC,WAAW,KAAK,SAAS;YACzB,SAAS,KAAK,OAAO;QACvB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,UAAU;YAAE,QAAQ;QAAI;IACnD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAsB,GAC/B;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}