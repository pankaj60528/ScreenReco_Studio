{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rohit/OneDrive/Desktop/shareable-screen-studio/src/lib/db.ts"],"sourcesContent":["import fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { nanoid } from 'nanoid';\r\n\r\nexport interface VideoRecord {\r\n  id: string;\r\n  title: string;\r\n  sourceUrl: string;\r\n  trimmedUrl: string;\r\n  durationSeconds: number | null;\r\n  trimStart?: number;\r\n  trimEnd?: number;\r\n  shareId: string;\r\n  viewCount: number;\r\n  completionPercent: number;\r\n  createdAt: string;\r\n}\r\n\r\ninterface StoreShape {\r\n  videos: VideoRecord[];\r\n}\r\n\r\nconst dataDir = path.join(process.cwd(), 'data');\r\nconst dataFile = path.join(dataDir, 'videos.json');\r\nconst tmpDataFile = path.join(dataDir, 'videos.json.tmp');\r\n\r\nasync function ensureStore(): Promise<StoreShape> {\r\n  await fs.mkdir(dataDir, { recursive: true });\r\n  try {\r\n    const content = await fs.readFile(dataFile, 'utf-8');\r\n    return JSON.parse(content) as StoreShape;\r\n  } catch (err: any) {\r\n    if (err?.code === 'ENOENT') {\r\n      const initial: StoreShape = { videos: [] };\r\n      await fs.writeFile(dataFile, JSON.stringify(initial, null, 2), 'utf-8');\r\n      return initial;\r\n    }\r\n    throw err;\r\n  }\r\n}\r\n\r\nasync function saveStore(store: StoreShape) {\r\n  const payload = JSON.stringify(store, null, 2);\r\n  await fs.writeFile(tmpDataFile, payload, 'utf-8');\r\n  await fs.rename(tmpDataFile, dataFile);\r\n}\r\n\r\nexport async function addVideo(params: {\r\n  title: string;\r\n  url: string;\r\n  durationSeconds?: number;\r\n  trimStart?: number;\r\n  trimEnd?: number;\r\n}): Promise<VideoRecord> {\r\n  const store = await ensureStore();\r\n  const id = nanoid(10);\r\n  const shareId = nanoid(8);\r\n  const record: VideoRecord = {\r\n    id,\r\n    title: params.title,\r\n    sourceUrl: params.url,\r\n    trimmedUrl: params.url,\r\n    durationSeconds: params.durationSeconds ?? null,\r\n    trimStart: params.trimStart,\r\n    trimEnd: params.trimEnd,\r\n    shareId,\r\n    viewCount: 0,\r\n    completionPercent: 0,\r\n    createdAt: new Date().toISOString(),\r\n  };\r\n  store.videos.push(record);\r\n  await saveStore(store);\r\n  return record;\r\n}\r\n\r\nexport async function getVideo(idOrShare: string): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  return store.videos.find((v) => v.id === idOrShare || v.shareId === idOrShare);\r\n}\r\n\r\n// FIX FOR ERROR 2: We name this 'getVideos'\r\nexport async function getVideos(): Promise<VideoRecord[]> {\r\n  const store = await ensureStore();\r\n  return store.videos;\r\n}\r\n\r\n// FIX FOR ERROR 1: This function was missing\r\nexport async function deleteVideo(idOrShare: string): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  const index = store.videos.findIndex((v) => v.id === idOrShare || v.shareId === idOrShare);\r\n  if (index === -1) return undefined;\r\n  const [removed] = store.videos.splice(index, 1);\r\n  await saveStore(store);\r\n  return removed;\r\n}\r\n\r\nexport async function incrementView(id: string): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  const video = store.videos.find((v) => v.id === id || v.shareId === id);\r\n  if (video) {\r\n    video.viewCount += 1;\r\n    await saveStore(store);\r\n  }\r\n  return video;\r\n}\r\n\r\nexport async function updateCompletion(id: string, completionPercent: number): Promise<VideoRecord | undefined> {\r\n  const store = await ensureStore();\r\n  const video = store.videos.find((v) => v.id === id || v.shareId === id);\r\n  if (video) {\r\n    video.completionPercent = Math.max(video.completionPercent, completionPercent);\r\n    await saveStore(store);\r\n  }\r\n  return video;\r\n}"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAoBA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACzC,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS;AACpC,MAAM,cAAc,4GAAI,CAAC,IAAI,CAAC,SAAS;AAEvC,eAAe;IACb,MAAM,gIAAE,CAAC,KAAK,CAAC,SAAS;QAAE,WAAW;IAAK;IAC1C,IAAI;QACF,MAAM,UAAU,MAAM,gIAAE,CAAC,QAAQ,CAAC,UAAU;QAC5C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAO,KAAU;QACjB,IAAI,KAAK,SAAS,UAAU;YAC1B,MAAM,UAAsB;gBAAE,QAAQ,EAAE;YAAC;YACzC,MAAM,gIAAE,CAAC,SAAS,CAAC,UAAU,KAAK,SAAS,CAAC,SAAS,MAAM,IAAI;YAC/D,OAAO;QACT;QACA,MAAM;IACR;AACF;AAEA,eAAe,UAAU,KAAiB;IACxC,MAAM,UAAU,KAAK,SAAS,CAAC,OAAO,MAAM;IAC5C,MAAM,gIAAE,CAAC,SAAS,CAAC,aAAa,SAAS;IACzC,MAAM,gIAAE,CAAC,MAAM,CAAC,aAAa;AAC/B;AAEO,eAAe,SAAS,MAM9B;IACC,MAAM,QAAQ,MAAM;IACpB,MAAM,KAAK,IAAA,2JAAM,EAAC;IAClB,MAAM,UAAU,IAAA,2JAAM,EAAC;IACvB,MAAM,SAAsB;QAC1B;QACA,OAAO,OAAO,KAAK;QACnB,WAAW,OAAO,GAAG;QACrB,YAAY,OAAO,GAAG;QACtB,iBAAiB,OAAO,eAAe,IAAI;QAC3C,WAAW,OAAO,SAAS;QAC3B,SAAS,OAAO,OAAO;QACvB;QACA,WAAW;QACX,mBAAmB;QACnB,WAAW,IAAI,OAAO,WAAW;IACnC;IACA,MAAM,MAAM,CAAC,IAAI,CAAC;IAClB,MAAM,UAAU;IAChB,OAAO;AACT;AAEO,eAAe,SAAS,SAAiB;IAC9C,MAAM,QAAQ,MAAM;IACpB,OAAO,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,aAAa,EAAE,OAAO,KAAK;AACtE;AAGO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,OAAO,MAAM,MAAM;AACrB;AAGO,eAAe,YAAY,SAAiB;IACjD,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM,MAAM,CAAC,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,aAAa,EAAE,OAAO,KAAK;IAChF,IAAI,UAAU,CAAC,GAAG,OAAO;IACzB,MAAM,CAAC,QAAQ,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC,OAAO;IAC7C,MAAM,UAAU;IAChB,OAAO;AACT;AAEO,eAAe,cAAc,EAAU;IAC5C,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,EAAE,OAAO,KAAK;IACpE,IAAI,OAAO;QACT,MAAM,SAAS,IAAI;QACnB,MAAM,UAAU;IAClB;IACA,OAAO;AACT;AAEO,eAAe,iBAAiB,EAAU,EAAE,iBAAyB;IAC1E,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,EAAE,OAAO,KAAK;IACpE,IAAI,OAAO;QACT,MAAM,iBAAiB,GAAG,KAAK,GAAG,CAAC,MAAM,iBAAiB,EAAE;QAC5D,MAAM,UAAU;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 169, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rohit/OneDrive/Desktop/shareable-screen-studio/app/api/videos/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { deleteVideo, getVideo } from \"@/lib/db\";\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\n\r\nexport const runtime = 'nodejs';\r\n\r\nexport async function GET(_: Request, { params }: { params: { id: string } }) {\r\n  try {\r\n    const video = await getVideo(params.id);\r\n    if (!video) return NextResponse.json({ error: \"Not found\" }, { status: 404 });\r\n    return NextResponse.json({ video });\r\n  } catch (error) {\r\n    console.error('GET /api/videos/[id] failed:', error);\r\n    return NextResponse.json({ error: \"Failed to load video\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(_: Request, { params }: { params: { id: string } }) {\r\n  try {\r\n    const video = await deleteVideo(params.id);\r\n    if (!video) return NextResponse.json({ error: \"Not found\" }, { status: 404 });\r\n\r\n    // If the video file is local, try to delete it\r\n    if (video.trimmedUrl.startsWith('/uploads/')) {\r\n      const filePath = path.join(process.cwd(), 'public', video.trimmedUrl);\r\n      try {\r\n        await fs.unlink(filePath);\r\n        console.log('Deleted local file:', filePath);\r\n      } catch (err) {\r\n        console.warn('Failed to delete local file:', filePath, err);\r\n        // Continue even if file deletion fails\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error('DELETE /api/videos/[id] failed:', error);\r\n    return NextResponse.json({ error: \"Failed to delete video\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,MAAM,UAAU;AAEhB,eAAe,IAAI,CAAU,EAAE,EAAE,MAAM,EAA8B;IAC1E,IAAI;QACF,MAAM,QAAQ,MAAM,IAAA,8HAAQ,EAAC,OAAO,EAAE;QACtC,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;QAC3E,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAM;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;AACF;AAEO,eAAe,OAAO,CAAU,EAAE,EAAE,MAAM,EAA8B;IAC7E,IAAI;QACF,MAAM,QAAQ,MAAM,IAAA,iIAAW,EAAC,OAAO,EAAE;QACzC,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;QAE3E,+CAA+C;QAC/C,IAAI,MAAM,UAAU,CAAC,UAAU,CAAC,cAAc;YAC5C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,MAAM,UAAU;YACpE,IAAI;gBACF,MAAM,gIAAE,CAAC,MAAM,CAAC;gBAChB,QAAQ,GAAG,CAAC,uBAAuB;YACrC,EAAE,OAAO,KAAK;gBACZ,QAAQ,IAAI,CAAC,gCAAgC,UAAU;YACvD,uCAAuC;YACzC;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF"}}]
}